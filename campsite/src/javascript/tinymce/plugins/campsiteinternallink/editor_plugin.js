(function(){tinymce.PluginManager.requireLangPack('campsiteinternallink');tinymce.create('tinymce.plugins.campsiteinternallink',{init:function(ed,url){this.editor=ed;ed.addCommand('mcecampsiteinternallink',function(){var se=ed.selection;var url_params='';if(se.isCollapsed()&&!ed.dom.getParent(se.getNode(),'A')){alert(ed.getLang('You need to select some text before creating a link'));return}var action='';var elm=se.getNode();elm=ed.dom.getParent(elm,"A");if(elm!=null&&elm.nodeName=="A"){action="update"}if(action=='update'){var href=ed.dom.getAttrib(elm,'href');publication=getURLVar('IdPublication',href);language=getURLVar('IdLanguage',href);issue=getURLVar('NrIssue',href);section=getURLVar('NrSection',href);article=getURLVar('NrArticle',href);url_params='?IdLanguage='+language+'&IdPublication='+publication+'&NrIssue='+issue+'&NrSection='+section+'&NrArticle='+article}ed.windowManager.open({file:url+'/link.php'+url_params,width:480+parseInt(ed.getLang('campsiteinternallink.delta_width',0)),height:360+parseInt(ed.getLang('campsiteinternallink.delta_height',0)),inline:1},{plugin_url:url})});ed.addButton('campsiteinternallink',{title:'campsiteinternallink.campsiteinternallink_desc',cmd:'mcecampsiteinternallink',image:url+'/img/campsiteinternallink.gif'});ed.addShortcut('ctrl+k','campsiteinternallink.campsiteinternallink_desc','mcecampsiteinternallink');ed.onNodeChange.add(function(ed,cm,n,co){cm.setDisabled('link',co&&n.nodeName!='A');cm.setActive('link',n.nodeName=='A'&&!n.name)})},getInfo:function(){return{longname:'campsiteinternallink',author:'Sourcefabric',authorurl:'http://www.sourcefabric.org',infourl:'http://dev.sourcefabric.org/browse/CS',version:'3.2'}}});tinymce.PluginManager.add('campsiteinternallink',tinymce.plugins.campsiteinternallink)})();function getURLVar(urlVarName,href){var urlHalves=String(href).split('?');var urlVarValue='';if(urlHalves[1]){var urlVars=urlHalves[1].split('&');for(i=0;i<=(urlVars.length);i++){if(urlVars[i]){var urlVarPair=urlVars[i].split('=');if(urlVarPair[0]&&urlVarPair[0]==urlVarName){urlVarValue=urlVarPair[1]}}}}return urlVarValue}