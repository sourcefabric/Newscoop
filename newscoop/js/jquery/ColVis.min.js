/*
 * File:        ColVis.min.js
 * Version:     1.0.1
 * Author:      Allan Jardine (www.sprymedia.co.uk)
 * 
 * Copyright 2010 Allan Jardine, all rights reserved.
 *
 * This source file is free software, under either the GPL v2 license or a
 * BSD (3 point) style license, as supplied with this software.
 * 
 * This source file is distributed in the hope that it will be useful, but 
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY 
 * or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
 */
(function(c){ColVis=function(a){if(!this.CLASS||this.CLASS!="ColVis")alert("Warning: ColVis must be initialised with the keyword 'new'");this.s={dt:null,activate:"click",buttonText:"Show / hide columns",hidden:true,aiExclude:[]};this.dom={wrapper:null,button:null,collection:null,background:null,catcher:null,buttons:[]};this.s.dt=a;this._fnConstruct();return this};ColVis.prototype={_fnConstruct:function(){this._fnApplyCustomisation();var a=this;this.dom.wrapper=document.createElement("div");this.dom.wrapper.className=
"ColVis TableTools";this.dom.button=this._fnDomBaseButton(this.s.buttonText);this.dom.wrapper.appendChild(this.dom.button);this.dom.catcher=this._fnDomCatcher();this.dom.collection=this._fnDomCollection();this.dom.background=this._fnDomBackground();this._fnAddButtons();this.s.dt.aoDrawCallback.push({fn:function(){a._fnDrawCallback.call(a)},sName:"ColVis"})},_fnApplyCustomisation:function(){if(typeof this.s.dt.oInit.oColVis!="undefined"){var a=this.s.dt.oInit.oColVis;if(typeof a.activate!="undefined")this.s.activate=
a.activate;if(typeof a.buttonText!="undefined")this.s.buttonText=a.buttonText;if(typeof a.aiExclude!="undefined")this.s.aiExclude=a.aiExclude}},_fnDrawCallback:function(){for(var a=this.s.dt.aoColumns,b=0,d=a.length;b<d;b++)if(this.dom.buttons[b]!==null)a[b].bVisible?c("input",this.dom.buttons[b]).attr("checked","checked"):c("input",this.dom.buttons[b]).removeAttr("checked")},_fnAddButtons:function(){for(var a,b=","+this.s.aiExclude.join(",")+",",d=0,f=this.s.dt.aoColumns.length;d<f;d++)if(b.indexOf(","+
d+",")==-1){a=this._fnDomColumnButton(d);this.dom.buttons.push(a);this.dom.collection.appendChild(a)}else this.dom.buttons.push(null)},_fnDomColumnButton:function(a){var b=this,d=this.s.dt.aoColumns[a],f=document.createElement("button"),g=document.createElement("span");f.className=!this.s.dt.bJUI?"ColVis_Button TableTools_Button":"ColVis_Button TableTools_Button ui-button ui-state-default";f.appendChild(g);c(g).html('<span class="ColVis_radio"><input type="checkbox"></span><span class="ColVis_title">'+
d.sTitle+"</span>");c(f).click(function(e){var h=c("input",this).attr("checked")===true?false:true;if(e.target.nodeName.toLowerCase()=="input")h=c("input",this).attr("checked");b.s.dt.oInstance.fnSetColumnVis(a,h)});return f},_fnDomBaseButton:function(a){var b=this,d=document.createElement("button"),f=document.createElement("span"),g=this.s.activate=="mouseover"?"mouseover":"click";d.className=!this.s.dt.bJUI?"ColVis_Button TableTools_Button":"ColVis_Button TableTools_Button ui-button ui-state-default";
d.appendChild(f);f.innerHTML=a;c(d).bind(g,function(e){b._fnCollectionShow();e.preventDefault()});return d},_fnDomCollection:function(){var a=document.createElement("div");a.style.display="none";a.className=!this.s.dt.bJUI?"ColVis_collection TableTools_collection":"ColVis_collection TableTools_collection ui-buttonset ui-buttonset-multi";a.style.position="absolute";c(a).css("opacity",0);return a},_fnDomCatcher:function(){var a=this,b=document.createElement("div");b.className="ColVis_catcher TableTools_catcher";
c(b).click(function(){a._fnCollectionHide.call(a,null,null)});return b},_fnDomBackground:function(){var a=this,b=document.createElement("div");b.style.position="absolute";b.style.left="0px";b.style.top="0px";b.className="TableTools_collectionBackground";c(b).css("opacity",0);c(b).click(function(){a._fnCollectionHide.call(a,null,null)});this.s.activate=="mouseover"&&c(b).mouseover(function(){a.s.overcollection=false;a._fnCollectionHide.call(a,null,null)});return b},_fnCollectionShow:function(){var a=
c(this.dom.button).offset(),b=this.dom.collection,d=this.dom.background,f=parseInt(a.left,10),g=parseInt(a.top+c(this.dom.button).outerHeight(),10);b.style.left=f+"px";b.style.top=g+"px";b.style.display="block";c(b).css("opacity",0);var e=c(window).height(),h=c(document).height(),j=c(window).width(),i=c(document).width();d.style.height=(e>h?e:h)+"px";d.style.width=(j<i?j:i)+"px";e=this.dom.catcher.style;e.height=c(this.dom.button).outerHeight()+"px";e.width=c(this.dom.button).outerWidth()+"px";e.top=
a.top+"px";e.left=f+"px";document.body.appendChild(d);document.body.appendChild(b);document.body.appendChild(this.dom.catcher);a=c(b).outerWidth();e=c(b).outerHeight();if(f+a>i)b.style.left=i-a+"px";if(g+e>h)b.style.top=g-e-c(nButton).outerHeight()+"px";setTimeout(function(){c(b).animate({opacity:1},500);c(d).animate({opacity:0.1},500)},10);this.s.hidden=false},_fnCollectionHide:function(){var a=this;if(!this.s.hidden&&this.dom.collection!==null){this.s.hidden=true;c(this.dom.collection).animate({opacity:0},
500,function(){this.style.display="none"});c(this.dom.background).animate({opacity:0},500,function(){document.body.removeChild(a.dom.background);document.body.removeChild(a.dom.catcher)})}}};ColVis.prototype.CLASS="ColVis";ColVis.VERSION="1.0.1";ColVis.prototype.VERSION=ColVis.VERSION;typeof c.fn.dataTable=="function"&&typeof c.fn.dataTableExt.fnVersionCheck=="function"&&c.fn.dataTableExt.fnVersionCheck("1.7.0")?c.fn.dataTableExt.aoFeatures.push({fnInit:function(a){return(new ColVis(a)).dom.wrapper},
cFeature:"C",sFeature:"ColVis"}):alert("Warning: ColVis requires DataTables 1.7 or greater - www.datatables.net/download")})(jQuery);
